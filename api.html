<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<!-- CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
	<style>

	@font-face {
		font-family: aquire;
		src: url(fonts/Aquire.otf);
	}

	nav{
		background-color: #141414;
		/*background-color: #21384e;*/
		/*background-color: #e74c3c;*/
	}

	.nav-link{
		font-family: montserrat;
		font-weight: 500;
	}
	body{
		color:#212529;
		background-color: #EEF0F2;
	}

	.imagesHolder{
		background-color:#0D21A1;
		color: #fff;
		padding-top:20px;
		padding-bottom:20px;
	}
	.quotesHolder{
		background-color:#011638;
		color: #fff;
		padding-top:20px;
		padding-bottom:20px;
	}
	.riddleHolder{
		background-color:#EEC643;
		color: #000;
		padding-top:20px;
		padding-bottom:20px;
	}

</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark p-0">
		<div class="container">
			<a class="navbar-brand" href="#" style="font-family: aquire; font-size:25px;">Styx</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item active">
						<a class="nav-link" href="#about">About</a>
					</li>
					
				</ul></div>

			</div>
		</nav>
		<div class="text-center">
			<h1>About</h1>
			<p>4 APIS, 5 functions</p>

			<div class="imagesHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-6 col-lg-6">
							<h4>Search term</h4>
							<p>What kind of image are you looking for?</p>
							<input type="text" class="form-control imageSearch">
							<p class="text-danger d-none errMsg">Something went wrong, Try another Keyword</p>
						</div>
						<div class="col-sm-12 col-md-6 col-lg-6" style="height:400px;">
							<img id="pixaImg" src="https://via.placeholder.com/400" alt="Image Not Loaded..." width="100%" style="max-height: 100%;">
						</div>
					</div>
				</div>
			</div>
			<div class="quotesHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-6 col-lg-6">
							<h4>Search term</h4>
							<p>What kind of quote are you looking for?</p>
							<input type="text" class="form-control quoteSearch">
						</div>
						<div class="col-sm-12 col-md-6 col-lg-6">
							<p class="qtPlace">This is where the quote will go</p><br><p class="author text-right"></p>
						</div>
					</div>
				</div>
			</div>
			<div class="combineHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-12 col-lg-12 text-center">
							<button class="btn btn-primary combineBtn mt-3 mb-3">Combine Image and quote</button><br>
							<canvas style="border-radius: 10px;border: 2px solid black;" id="canvas" width="800" height="500"></canvas><br>
							<button class="btn btn-success downloadBtn mt-3 mb-3">Download Image</button><br>
						</div>
					</div>
				</div>
			</div>
			<div class="riddleHolder">
				<div class="container">
					<div class="row" style="align-items: center;">
						<div class="col-sm-12 col-md-12 col-lg-12 text-center">
							<div class="riddle"></div>
							<input type="text" class="form-control">
							<div class="answer"></div>
						</div>
					</div>
				</div>
			</div>


		</div>

		<!-- JS: move to bottom -->
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
		<script>
			fetch("/riddles.json").then(res => console.log(res));
			$(".imageSearch").on("keyup",function(){
				var keyword = this.value;
				keyword = keyword.replace(" ", "+");
				$.ajax({
					type: "GET",
					url: "https://pixabay.com/api/?key=22374336-f544c10298c5719990869d8fd",
					data: {q: keyword},
					success: function(result) {
						// console.log(result);
						if (result.hits.length < 2){
							$("#pixaImg").attr("src","https://via.placeholder.com/400");
							$(".errMsg").removeClass("d-none");
						}
						else{
							$(".errMsg").addClass("d-none");
							arr = result.hits;
							rnd = Math.floor(Math.random() * arr.length);
							$("#pixaImg").attr("src",arr[rnd].largeImageURL);
						}
					},
					error: function(result){
						console.log("Error: " + result.errorMessage);
					} 
				});
			});

			$(".quoteSearch").on("keyup",function(){
				var keyword = this.value;
				keyword = keyword.replace(" ", "|").toLowerCase();
				$.ajax({
					type: "GET",
					url: "https://api.quotable.io/quotes",
					data: {tags: keyword},
					success: function(result) {
						// console.log(result);
						if (result.results.length < 2){
							$(".qtPlace").addClass("text-danger").html("Something went wrong. Try terms like: 'Life', 'Love', 'happiness', 'technology', 'history' etc.");
						}
						else{
							arr = result.results;
							rnd = Math.floor(Math.random() * arr.length);
							$(".qtPlace").removeClass("text-danger").html(arr[rnd].content);
							$(".author").html("- "+arr[rnd].author);
						}
						
						
					},
					error: function(result){
						console.log("Error: " + result.errorMessage);
					} 
				});
			});

			$(".combineBtn").on("click",function(){
				var canvas = document.getElementById("canvas");
				var ctx = canvas.getContext("2d");
				var img = new Image();
				img.src = $("#pixaImg").attr("src");
				img.crossOrigin="anonymous";
				img.onload = function() {
					ctx.drawImage(img, 0, 0);
					ctx.fillStyle = '#000000b3';
					ctx.fillRect(0, 0, 800, 500);

					ctx.beginPath();
					ctx.fillStyle = '#fff';
					ctx.font = "20px arial";
					ctx.textAlign = "center";
					ctx.textBaseline = "middle";
					var arr = $(".qtPlace").html().split(" ");
					var arr2 = []
					var text = "";
					for (var i = 0; i <= arr.length; i++) {
						if (arr[i] != undefined){	
							text += arr[i] + " ";
						}
						if (i >= 7 && (i % 8) == 0 || i == arr.length){
							arr2.push(text);
							text = "";
						}
					}
					// console.log(arr2);

					for (var i = 0; i < arr2.length; i++) {
						x = 100 + (50 * (i + 1));
						ctx.fillText(arr2[i], 400, x);
					}
					ctx.fillText($(".author").html(), 550, 450);
					ctx.closePath();
				};
			});

			$(".downloadBtn").on("click",function(){
				var canvas = document.getElementById("canvas");
				var imageData = canvas.toDataURL();
				var tmpLink = document.createElement( 'a' );  
				tmpLink.download = 'quoteImage.png'; 
				tmpLink.href = imageData;  

				document.body.appendChild( tmpLink );  
				tmpLink.click();  
				document.body.removeChild( tmpLink );
			})
		</script>
	</body>
	</html>